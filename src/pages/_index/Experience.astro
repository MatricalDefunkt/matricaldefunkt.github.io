---
import ListItem from "../../components/ui/ListItem.astro";
import Card from "../../components/ui/Card.astro";
import ChevronToggle from "../../components/ui/ChevronToggle.astro";

interface Job {
  role: string;
  company: string;
  date: string;
  type?: "Full-time" | "Part-time";
  summary: string;
  projects?: { name: string; description: string }[];
}

const jobs: Job[] = [
  {
    role: "Cloud Infrastructure Engineer (Trainee)",
    company: "Mobigic Technologies",
    date: "Nov 2025 - Present",
    summary:
      "Leading the enterprise-wide migration from Azure to Vultr, architecting cloud-native infrastructure and owning the CI/CD pipelines.",
    projects: [
      {
        name: "Hybrid Kubernetes",
        description:
          "Provisioned RKE2 clusters (Linux & Windows) via Terraform, securing networks with VPCs, subnets, VPNs, and Bastion hosts.",
      },
      {
        name: "CI/CD Infrastructure",
        description:
          "Built Gitea Actions & Jenkins pipelines for Android/Web/iOS builds, utilizing Cloudflare Tunnels to utilize on-prem Mac hardware.",
      },
      {
        name: "Security & Observability",
        description:
          "Integrated Docker Scout and Trivy into the CI/CD pipeline for optimal security, alongside Prometheus and Grafana for monitoring.",
      },
      {
        name: "Database Administration",
        description:
          "Administered and optimized MSSQL and MySQL servers to ensure high availability and performance.",
      },
    ],
  },
  {
    role: "Software Engineer (Trainee)",
    company: "Mobigic Technologies",
    date: "Jul 2025 - Nov 2025",
    summary:
      "Built internal tooling at Mobigic including a custom Go CI runner, an AI resume matcher, a flow automation engine, and optimized legacy infrastructure.",
    projects: [
      {
        name: "Custom Gitea Runner",
        description:
          "Built a custom runner in Go, reducing CI/CD build times by 20%.",
      },
      {
        name: "AI Resume Matcher",
        description:
          "Architected an Async Monolith using FastAPI and LLMs for intelligent resume parsing.",
      },
      {
        name: "JIT Graph Engine",
        description:
          "Developed in React/MUI & Go/Postgres to accelerate business processes and reduce handbook reliance.",
      },
      {
        name: "Legacy Optimization",
        description:
          "Dockerized and optimized a legacy SailsJS application, achieving a 100% increase in performance.",
      },
    ],
  },
  {
    role: "Application Development Intern",
    company: "Project: Human City",
    date: "Aug 2024 - Jul 2025",
    type: "Part-time",
    summary:
      "Led a 6-person team to architect a decentralized social platform, decomposing a monolith into 12 microservices and slashing deploy latency by 80%.",
    projects: [
      {
        name: "Decentralized Social Media",
        description:
          "Led a team of 6 to architect and implement the platform, managing agile workflows and client requirements.",
      },
      {
        name: "Microservices Migration",
        description:
          "Decomposed a legacy Express monolith into 12 scalable, event-driven microservices.",
      },
      {
        name: "AWS CI/CD Pipelines",
        description:
          "Established automated deployment pipelines that reduced deployment latency by 80%.",
      },
    ],
  },
  {
    role: "Backend Developer Intern",
    company: "Entelligentsia LLP",
    date: "Dec 2023 - Jan 2024",
    summary:
      "Built serverless real-time APIs on AWS Lambda and API Gateway, hardened with strict auth and backed by optimized DynamoDB and S3 storage.",
    projects: [
      {
        name: "Serverless APIs",
        description:
          "Built real-time messaging and data streaming services using AWS Lambda and API Gateway.",
      },
      {
        name: "Cloud Security",
        description:
          "Ensured security and compliance by implementing strict AWS IAM roles and policies.",
      },
      {
        name: "Data Optimization",
        description:
          "Optimized performance and scalable data storage utilizing DynamoDB and S3.",
      },
    ],
  },
];
---

<section>
  <h2>Experience</h2>
  <div class="experience-list">
    {
      jobs.map((job) => (
        <ListItem
          title={job.role}
          subtitle={job.company}
          date={job.date}
          badge={job.type}
        >
          <div class="job-summary-row">
            <p class="job-summary">{job.summary}</p>
            {job.projects && <ChevronToggle ariaLabel="Show projects" />}
          </div>
          {job.projects && (
            <div class="job-details">
              <div class="job-details-inner">
                <div class="job-projects-grid">
                  {job.projects.map((project) => (
                    <Card variant="minimal">
                      <span class="project-name">{project.name}</span>
                      <span class="project-desc">{project.description}</span>
                    </Card>
                  ))}
                </div>
              </div>
            </div>
          )}
        </ListItem>
      ))
    }
  </div>
</section>

<style>
  .experience-list {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
  }

  .job-summary-row {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    cursor: pointer;
  }

  .job-summary {
    flex: 1;
    font-size: 0.95rem;
    color: var(--secondary-text);
    margin: 0;
    line-height: 1.5;
  }

  /* Collapsible details */
  .job-details {
    display: grid;
    grid-template-rows: 0fr;
    transition:
      grid-template-rows 0.3s ease-out,
      margin-top 0.3s ease-out;
    margin-top: 0;
  }

  .job-details.expanded {
    grid-template-rows: 1fr;
    margin-top: 0.25rem;
  }

  .job-details-inner {
    overflow: hidden;
    min-height: 0;
  }

  .job-projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 0.75rem;
    padding-top: 0.5rem;
  }

  .project-name {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-color);
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .project-name::before {
    content: "";
    display: inline-block;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: var(--accent-color);
  }

  .project-desc {
    font-size: 0.85rem;
    color: var(--secondary-text);
    line-height: 1.5;
  }

  @media (max-width: 900px) {
    .job-projects-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  document.querySelectorAll<HTMLElement>(".job-summary-row").forEach((row) => {
    row.addEventListener("click", () => {
      const listItem = row.closest(".list-item");
      if (!listItem) return;

      const details = listItem.querySelector<HTMLElement>(".job-details");
      const btn = row.querySelector<HTMLButtonElement>(".chevron-toggle");
      if (!details || !btn) return;

      btn.classList.toggle("active");
      details.classList.toggle("expanded");
      btn.setAttribute(
        "aria-expanded",
        btn.classList.contains("active") ? "true" : "false",
      );
    });
  });
</script>
